-- Estimated Loss
SELECT
    SUM(
        -- Calculation: (Target RPM - Actual RPM) * Trip Duration (Minutes)
        (1.89 - (t.calculated_total_amount / t.trip_duration_minutes)) * t.trip_duration_minutes
    ) AS Total_Estimated_Annual_Revenue_Loss
    
FROM
    `nyc-taxi-478617.2024_data.yellow_trips_2024_cleaned` AS t

WHERE
    t.trip_duration_minutes > 1.0 
    AND t.calculated_total_amount > 2.0 
    AND (t.calculated_total_amount / t.trip_duration_minutes) < 1.89

-- ROI for Bottom 
SELECT
    -- Calculation: (Target RPM - Segment RPM) * Total Trips * Average Duration
    SUM(
        (1.89 - median_rpm_usd_per_min) * total_trips_in_segment * average_trip_duration_minutes
    ) AS Total_Estimated_Recovery
FROM
    `nyc-taxi-478617.2024_data.bottom_10_segments_for_roi`;

-- ROI for Top
SELECT
    -- Calculation: (Segment RPM - Target RPM) * Total Trips * Average Duration
    SUM(
        (median_rpm_usd_per_min - 1.89) * total_trips_in_segment * average_trip_duration_minutes
    ) AS Total_Estimated_Surcharge_Revenue
FROM
    `nyc-taxi-478617.2024_data.top_10_segments_for_roi`;
