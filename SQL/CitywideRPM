SELECT
  -- **CHANGED: Calculate the citywide Median RPM (50th percentile)**
  APPROX_QUANTILES(calculated_total_amount / trip_duration_minutes, 2)[OFFSET(1)] AS citywide_median_rpm,
  
  -- Calculate the traditional Mean RPM for comparison and context
  AVG(calculated_total_amount / trip_duration_minutes) AS citywide_mean_rpm,

  -- Total trips analyzed for context
  COUNT(1) AS total_trips_analyzed,
  
  -- Average trip duration for context
  AVG(trip_duration_minutes) AS average_trip_duration_minutes
FROM
  `nyc-taxi-478617.2024_data.yellow_trips_2024_cleaned`;
